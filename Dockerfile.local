FROM node:18

WORKDIR /app

# Copy backend package files and install deps
COPY package*.json ./
RUN npm install

# --- React frontend build ---
# Copy frontend source code
COPY frontend ./frontend
WORKDIR /app/frontend

RUN npm install && npm run build

# Move the build folder to root (where app.js expects it)
RUN mv build /app/build

# --- Back to backend ---
WORKDIR /app
COPY . .  
# includes src/, app.js, etc.

CMD ["npm", "start"]
